FROM jldeen/alpine-docker
MAINTAINER jessde@microsoft.com

# Copy app folder from repo to container
COPY app ./app

# Copy deployment scripts folder from repo to container
COPY deployment ./deployment

# Copy FQDN and private key
COPY fqdn ./
COPY id_rsa /root/.ssh/id_rsa

# Turn SSH on and add private key to identities

RUN eval `ssh-agent -s` && /usr/bin/ssh-add /root/.ssh/id_rsa

# Set DOCKER_HOST Env Variable
ENV DOCKER_HOST=:2375

# Confirm env var set properly - testing only
RUN echo $DOCKER_HOST

# Expose port for container
EXPOSE 2375

COPY ssh-tunnel.sh /usr/local/bin/

# Entrypoint for SSH tunnel
ENTRYPOINT ["/usr/local/bin/ssh-tunnel.sh"]

CMD ["bash"]

